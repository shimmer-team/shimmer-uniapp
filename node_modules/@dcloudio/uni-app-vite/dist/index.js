"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const uni_cli_shared_1 = require("@dcloudio/uni-cli-shared");
const uni_cli_nvue_1 = require("@dcloudio/uni-cli-nvue");
const plugin_1 = require("./plugin");
const template_1 = require("./plugins/template");
const mainJs_1 = require("./plugins/mainJs");
const manifestJson_1 = require("./plugins/manifestJson");
const pagesJson_1 = require("./plugins/pagesJson");
// import { uniResolveIdPlugin } from './plugins/resolveId'
const renderjs_1 = require("./plugins/renderjs");
const stats_1 = require("./plugins/stats");
const easycom_1 = require("./plugins/easycom");
const confusion_1 = require("./plugins/confusion");
const nvue_1 = require("./nvue");
const entry_1 = require("./nvue/plugins/entry");
function initUniCssScopedPluginFilter(inputDir) {
    const styleIsolation = (0, uni_cli_shared_1.getAppStyleIsolation)((0, uni_cli_shared_1.parseManifestJsonOnce)(inputDir));
    if (styleIsolation === 'shared') {
        return;
    }
    if (styleIsolation === 'isolated') {
        // isolated: 对所有非 App.vue 增加 scoped
        return (id) => (0, uni_cli_shared_1.isVueSfcFile)(id) && !id.endsWith('App.vue');
    }
    // apply-shared: 仅对非页面组件增加 scoped
    return (id) => (0, uni_cli_shared_1.isVueSfcFile)(id) && !id.endsWith('App.vue') && !(0, uni_cli_shared_1.isUniPageFile)(id, inputDir);
}
const plugins = [
    (0, easycom_1.uniEasycomPlugin)({ exclude: uni_cli_shared_1.UNI_EASYCOM_EXCLUDE }),
    // uniResolveIdPlugin(),
    (0, uni_cli_shared_1.uniHBuilderXConsolePlugin)(),
    (0, mainJs_1.uniMainJsPlugin)(),
    (0, manifestJson_1.uniManifestJsonPlugin)(),
    (0, pagesJson_1.uniPagesJsonPlugin)(),
    (0, uni_cli_shared_1.uniViteInjectPlugin)((0, uni_cli_shared_1.initAppProvide)()),
    (0, renderjs_1.uniRenderjsPlugin)(),
    (0, template_1.uniTemplatePlugin)(),
    (0, stats_1.uniStatsPlugin)(),
    (0, plugin_1.uniAppPlugin)(),
    (0, confusion_1.uniConfusionPlugin)(),
];
const filter = initUniCssScopedPluginFilter(process.env.UNI_INPUT_DIR);
if (filter) {
    plugins.unshift((0, uni_cli_shared_1.uniCssScopedPlugin)({ filter }));
}
if (process.env.UNI_NVUE_COMPILER === 'vite') {
    plugins.push((0, nvue_1.uniNVuePlugin)('pages/demo/demo'));
    plugins.push((0, entry_1.uniNVueEntryPlugin)());
}
else if (process.env.UNI_NVUE_COMPILER !== 'vue') {
    plugins.push(...uni_cli_nvue_1.plugins);
}
exports.default = plugins;
